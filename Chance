--// Character Aimbot with Open/Close GUI
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Settings
local Enabled = false
local AimRange = 150
local Prediction = 0.3

-- Animation IDs
local AnimIDs = {
    ["103601716322988"]=true,
    ["133491532453922"]=true,
    ["86371356500204"]=true,
    ["76649505662612"]=true,
    ["81698196845041"]=true,
    ["111313169447787"]=true, -- MLG Chance
}

local ActiveAnims = {}

-- GUI
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local ScreenGui = Instance.new("ScreenGui", PlayerGui)
ScreenGui.Name = "AimbotUI"
ScreenGui.ResetOnSpawn = false

-- Open Button
local OpenButton = Instance.new("TextButton", ScreenGui)
OpenButton.Size = UDim2.new(0,80,0,30)
OpenButton.Position = UDim2.new(0,10,0,10)
OpenButton.Text = "Open"
OpenButton.BackgroundColor3 = Color3.fromRGB(0,170,255)
OpenButton.TextColor3 = Color3.fromRGB(255,255,255)

-- Main Frame
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0,250,0,180)
MainFrame.Position = UDim2.new(0,100,0,50)
MainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
MainFrame.Visible = false

-- Close Button
local CloseButton = Instance.new("TextButton", MainFrame)
CloseButton.Size = UDim2.new(0,50,0,25)
CloseButton.Position = UDim2.new(1,-55,0,5)
CloseButton.Text = "Close"
CloseButton.BackgroundColor3 = Color3.fromRGB(200,50,50)
CloseButton.TextColor3 = Color3.fromRGB(255,255,255)

-- Toggle Aimbot
local ToggleButton = Instance.new("TextButton", MainFrame)
ToggleButton.Size = UDim2.new(0,200,0,40)
ToggleButton.Position = UDim2.new(0,25,0,10)
ToggleButton.Text = "Aimbot: OFF"
ToggleButton.BackgroundColor3 = Color3.fromRGB(50,150,250)
ToggleButton.TextColor3 = Color3.fromRGB(255,255,255)

ToggleButton.MouseButton1Click:Connect(function()
    Enabled = not Enabled
    ToggleButton.Text = "Aimbot: "..(Enabled and "ON" or "OFF")
end)

-- Aim Range TextBox
local RangeBox = Instance.new("TextBox", MainFrame)
RangeBox.Size = UDim2.new(0,200,0,30)
RangeBox.Position = UDim2.new(0,25,0,60)
RangeBox.PlaceholderText = "Aim Range (Default 150)"
RangeBox.Text = tostring(AimRange)
RangeBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
RangeBox.TextColor3 = Color3.fromRGB(255,255,255)

RangeBox.FocusLost:Connect(function()
    local num = tonumber(RangeBox.Text)
    if num then AimRange=num else RangeBox.Text=tostring(AimRange) warn("Invalid Range") end
end)

-- Prediction TextBox
local PredictionBox = Instance.new("TextBox", MainFrame)
PredictionBox.Size = UDim2.new(0,200,0,30)
PredictionBox.Position = UDim2.new(0,25,0,100)
PredictionBox.PlaceholderText = "Prediction (Default 0.3)"
PredictionBox.Text = tostring(Prediction)
PredictionBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
PredictionBox.TextColor3 = Color3.fromRGB(255,255,255)

PredictionBox.FocusLost:Connect(function()
    local num = tonumber(PredictionBox.Text)
    if num then Prediction=num else PredictionBox.Text=tostring(Prediction) warn("Invalid Prediction") end
end)

-- Open/Close functionality
OpenButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    OpenButton.Visible = false
end)

CloseButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    OpenButton.Visible = true
end)

-- Animation detection
local function setupAnimDetect(char)
    local humanoid = char:WaitForChild("Humanoid")
    local animator = humanoid:WaitForChild("Animator")
    animator.AnimationPlayed:Connect(function(track)
        local id = track.Animation.AnimationId:match("%d+")
        if AnimIDs[id] then
            ActiveAnims[id] = true
            track.Stopped:Connect(function() ActiveAnims[id]=nil end)
        end
    end)
end

if LocalPlayer.Character then setupAnimDetect(LocalPlayer.Character) end
LocalPlayer.CharacterAdded:Connect(setupAnimDetect)

-- Aimbot loop
RunService.RenderStepped:Connect(function()
    if not Enabled then return end
    if next(ActiveAnims)==nil then return end
    local myChar=LocalPlayer.Character
    if not myChar or not myChar:FindFirstChild("HumanoidRootPart") then return end

    local closestTarget=nil
    local shortestDist=AimRange

    for _,player in pairs(Players:GetPlayers()) do
        if player~=LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp=player.Character.HumanoidRootPart
            local humanoid=player.Character:FindFirstChild("Humanoid")
            if humanoid and humanoid.Health>131 then
                local dist=(myChar.HumanoidRootPart.Position-hrp.Position).Magnitude
                if dist<shortestDist then
                    shortestDist=dist
                    closestTarget=hrp
                end
            end
        end
    end

    if closestTarget then
        local targetPos=closestTarget.Position+(closestTarget.Velocity*Prediction)
        myChar.HumanoidRootPart.CFrame=CFrame.new(myChar.HumanoidRootPart.Position,targetPos)
    end
end)
